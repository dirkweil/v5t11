<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/WEB-INF/templates/leitstand.xhtml">
  <ui:param name="title" value="Stellwerk ${stellwerkPresenter.stellwerk.bereich}"/>
  <ui:define name="content">
    <p:remoteCommand name="elementClicked"
                     action="${stellwerkPresenter.elementClicked}"
                     process="wsid"
                     update="controlPanel :messages"/>

    <h:panelGroup id="stellwerk" layout="block" styleClass="stellwerk">
      <ui:repeat var="zeile" value="${stellwerkPresenter.stellwerk.zeilen}">
        <ui:repeat var="element" value="${zeile.elemente}">
          <canvas id="${element.uiId}"
                  width="1000" height="1000"
                  style="grid-row-start: ${element.zeilenNr}; grid-column-start: ${element.spaltenNr}"
                  onclick="elementClicked([{name:'uiId', value:'${element.uiId}'}])">
          </canvas>
        </ui:repeat>
      </ui:repeat>
    </h:panelGroup>

    <h:inputText id="wsid" value="${stellwerkPresenter.webSocketSessionId}" style="display: none"/>

    <h:outputStylesheet name="stellwerk.css"/>
    <h:outputScript name="stellwerk.js"/>

    <!--    <f:websocket channel="stellwerk/xyz" onmessage="updateElemente"/>-->

  </ui:define>

  <ui:define name="extra">
    <h:panelGroup id="controlPanel" layout="block">
      <h:panelGroup layout="block" styleClass="controlPanel" rendered="${stellwerkPresenter.controlPanelEnabled}">
        <h:panelGrid columns="2">
          <h:outputText value="#{stellwerkPresenter.signalId.name}" rendered="${! empty stellwerkPresenter.signalId}"/>
          <p:selectOneButton id="signal" value="#{stellwerkPresenter.signalStellung}" unselectable="false"
                             rendered="${! empty stellwerkPresenter.signalId}">
            <f:selectItems value="#{stellwerkPresenter.signalStellungen}"/>
            <p:ajax update="signal :messages"/>
          </p:selectOneButton>

          <h:outputText value="#{stellwerkPresenter.weiche1Id.name}"
                        rendered="${! empty stellwerkPresenter.weiche1Id}"/>
          <p:selectOneButton id="weiche1" value="#{stellwerkPresenter.weiche1Stellung}" unselectable="false"
                             rendered="${! empty stellwerkPresenter.weiche1Id}">
            <f:selectItems value="#{stellwerkPresenter.weichenStellungen}"/>
            <p:ajax update="weiche1 :messages"/>
          </p:selectOneButton>

          <h:outputText value="#{stellwerkPresenter.weiche2Id.name}"
                        rendered="${! empty stellwerkPresenter.weiche2Id}"/>
          <p:selectOneButton id="weiche2" value="#{stellwerkPresenter.weiche2Stellung}" unselectable="false"
                             rendered="${! empty stellwerkPresenter.weiche2Id}">
            <f:selectItems value="#{stellwerkPresenter.weichenStellungen}"/>
            <p:ajax update="weiche2 :messages"/>
          </p:selectOneButton>

          <h:panelGroup/>
          <p:commandButton value="abbrechen" action="${stellwerkPresenter.clearControlPanel()}" update="controlPanel"/>
        </h:panelGrid>
      </h:panelGroup>
    </h:panelGroup>

    <p:remoteCommand name="updateControlPanel" update="controlPanel"/>
  </ui:define>
</ui:composition>
</html>
