<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/templates/fahrzeugManagement.xhtml">
  <ui:define name="content">
    <h:form id="fahrzeug-config">
      <h:panelGrid columns="1">
        <p:toolbar>
          <f:facet name="left">
            <h:outputText
                value="#{fahrzeugProgramPresenter.currentFahrzeug.id.adresse}@#{fahrzeugProgramPresenter.currentFahrzeug.id.systemTyp}"
                id="id" style="vertical-align: middle;"/>
            <p:graphicImage name="#{fahrzeugPresenter.getImage(fahrzeugPresenter.currentFahrzeug)}" id="image"
                            height="50px" style="vertical-align: middle; margin-left: 20px; margin-right: 20px;"/>
            <h:outputLabel value="Betriebsnummer: " for="betriebsnummer"/>
            <p:inputText value="#{fahrzeugProgramPresenter.currentFahrzeug.betriebsnummer}" size="15"
                         style="vertical-align: middle;" id="betriebsnummer"/>
          </f:facet>
          <f:facet name="right">
            <p:commandButton value="Speichern" icon="pi pi-save"
                             title="Einträge speichern (ohne Ist-Werte)"
                             action="#{fahrzeugProgramPresenter.save()}"
                             ajax="false"/>

            <span class="ui-separator"> <span class="ui-icon pi pi-ellipsis-v"/>
            </span>

            <p:commandButton value="zurück" icon="pi pi-times" action="#{fahrzeugPresenter.cancel()}" ajax="false"
                             immediate="true"/>
          </f:facet>
        </p:toolbar>

        <p:dataTable value="#{fahrzeugProgramPresenter.currentFahrzeug.konfigurationen}"
                     var="konfiguration"
                     sortBy="#{konfiguration.nr}"
                     rowStyleClass="topAligned"
                     id="konfigurationen">
          <p:column width="40">
            <f:facet name="header">
              <p:commandButton icon="pi pi-plus" title="Neu" style="width: 100%"
                               action="#{fahrzeugProgramPresenter.addKonfiguration()}"
                               immediate="true"
                               update="konfigurationen"/>
            </f:facet>
            <p:commandButton icon="pi pi-trash" title="Löschen" style="width: 100%"
                             action="#{fahrzeugProgramPresenter.removeKonfiguration(konfiguration)}"
                             immediate="true"
                             update="konfigurationen"/>
          </p:column>

          <p:column headerText="#{fahrzeugProgramPresenter.currentFahrzeug.id.systemTyp.konfigWertBezeichnung}"
                    sortBy="#{konfiguration.nr}" width="60">
            <p:inputText value="#{konfiguration.nr}" readonly="#{!empty konfiguration.nr}" style="width: 100%" id="nr"/>
            <p:message for="nr"/>
          </p:column>

          <p:column headerText="Beschreibung" sortable="false">
            <p:inputTextarea value="#{konfiguration.beschreibung}" style="width: 100%" rows="1" id="beschreibung"/>
            <p:message for="nr"/>
          </p:column>

          <p:column width="40">
            <f:facet name="header">
              <p:commandButton icon="pi pi-upload" title="Alle Werte in Fahrzeug programmieren"
                               style="width: 100%"
                               action="#{fahrzeugProgramPresenter.writeAllKonfigurationen()}"
                               update="konfigurationen"/>
            </f:facet>
            <p:commandButton icon="pi pi-upload" title="Wert in Fahrzeug programmieren"
                             style="width: 100%"
                             action="#{fahrzeugProgramPresenter.writeKonfiguration(konfiguration)}"
                             update="konfigurationen"/>
          </p:column>

          <p:column headerText="Soll" sortable="false" width="150">
            <p:inputText value="#{konfiguration.soll}" style="width: 100%" id="soll"/>
            <p:message for="nr"/>
          </p:column>

          <p:column width="40">
            <f:facet name="header">
              <p:commandButton icon="pi pi-angle-left" title="Alle Ist-Werte als Sollwerte übernehmen"
                               style="width: 100%"
                               action="#{fahrzeugProgramPresenter.copyIst2SollAll()}"
                               update="konfigurationen"/>
            </f:facet>
            <p:commandButton icon="pi pi-angle-left" title="Ist-Wert als Sollwert übernehmen"
                             style="width: 100%"
                             action="#{fahrzeugProgramPresenter.copyIst2Soll(konfiguration)}"
                             update="konfigurationen"/>
          </p:column>

          <p:column headerText="Ist" sortable="false" width="150">
            <p:inputText value="#{konfiguration.ist}" readonly="true" style="width: 100%" id="ist"/>
          </p:column>

          <p:column width="40">
            <f:facet name="header">
              <p:commandButton icon="pi pi-download" title="Alle Werte aus Fahrzeug lesen"
                               style="width: 100%"
                               action="#{fahrzeugProgramPresenter.readAllKonfigurationen()}"
                               update="konfigurationen"/>
            </f:facet>
            <p:commandButton icon="pi pi-download" title="Wert aus Fahrzeug lesen"
                             style="width: 100%"
                             action="#{fahrzeugProgramPresenter.readKonfiguration(konfiguration)}"
                             update="konfigurationen"/>
          </p:column>
        </p:dataTable>
      </h:panelGrid>
    </h:form>

    <h:form id="fahrzeug-read-write-confirm">
      <p:dialog
          header="#{fahrzeugProgramPresenter.selectedAktionsBeschreibung}"
          showEffect="fade" modal="true" widgetVar="fahrzeugReadWriteConfirm">
        <h:panelGrid columns="1">
          <h:outputText value="Das Fahrzeug muss sich alleine auf dem Programmiergleis befinden!"/>

          <h:panelGroup>
            <p:commandButton value="ok" icon="pi pi-check"
                             actionListener="#{fahrzeugProgramPresenter.execSelectedAktion()}"
                             process="@form"/>
            <p:commandButton value="abbrechen" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
                             onclick="PF('fahrzeugReadWriteConfirm').hide()"/>
          </h:panelGroup>
        </h:panelGrid>
      </p:dialog>

    </h:form>
  </ui:define>
</ui:composition>
</html>
