<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/templates/fahrzeugManagement.xhtml">
  <ui:define name="content">
    <h:form id="fahrzeug">
      <h2>Fahrzeug steuern</h2>

      <p:toolbar>
        <f:facet name="left">
          <h:outputText value="#{fahrzeugControlPresenter.currentFahrzeug.betriebsnummer}"
                        style="font-size: 30px; vertical-align: middle;"/>
          <p:graphicImage name="#{fahrzeugPresenter.getImage(fahrzeugControlPresenter.currentFahrzeug)}" height="50px"
                          style="vertical-align: middle; margin-left: 20px; margin-right: 20px;"/>
          <h:outputText
              value="#{fahrzeugControlPresenter.currentFahrzeug.id.adresse}@#{fahrzeugControlPresenter.currentFahrzeug.id.systemTyp}"
              id="id" style="vertical-align: middle;"/>
        </f:facet>
        <f:facet name="right">
          <p:commandButton value="zur체ck" icon="pi pi-times" action="finished" ajax="false" immediate="true"/>
        </f:facet>
      </p:toolbar>

      <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" id="lok">
        <p:outputLabel for="lokAktiv" value="Aktiv:"/>
        <p:selectBooleanButton id="lokAktiv" value="#{fahrzeugControlPresenter.lokAktiv}" onLabel="aktiv"
                               offLabel="inaktiv" style="width:120px">
          <p:ajax/>
        </p:selectBooleanButton>

        <p:outputLabel for="lokFahrstufe" value="Fahrstufe:"/>
        <h:panelGrid id="lokFahrstufe" columns="2">
          <p:inputText id="fahrstufe" value="#{fahrzeugControlPresenter.lokFahrstufe}"/>
          <p:selectBooleanButton id="lokRueckwaerts" value="#{fahrzeugControlPresenter.lokRueckwaerts}"
                                 onLabel="r체ckw채rts" offLabel="vorw채rts" style="width:120px">
            <p:ajax/>
          </p:selectBooleanButton>
          <p:slider for="fahrstufe" minValue="0" maxValue="#{fahrzeugControlPresenter.lokMaxFahrstufe}">
            <p:ajax process="fahrstufe"/>
          </p:slider>
          <h:panelGroup/>
        </h:panelGrid>

        <c:forEach items="#{fahrzeugControlPresenter.currentFunktionsGruppen}" var="lfcg">
          <p:outputLabel value="#{lfcg.name}:"/>
          <h:panelGroup>
            <c:forEach items="#{fahrzeugControlPresenter.getLokFunktionen(lfcg)}" var="fc">
              <p:selectBooleanButton onLabel="#{fc.onLabel}" offLabel="#{fc.offLabel}" value="#{fc.aktiv}">
                <p:ajax update="lok"/>
              </p:selectBooleanButton>
            </c:forEach>
          </h:panelGroup>
        </c:forEach>
      </h:panelGrid>


    </h:form>

    <p:remoteCommand name="updateFahrzeug" update=":fahrzeug"/>
    <!--
      Das JSF-Tag funktioniert mit Quarkus/MyFaces nicht. Daher JS-Workaround.
      <f:websocket channel="fahrzeug-control" onmessage="updateFahrzeug"/>
      -->
    <h:outputScript target="body">
      let fahrzeugControlSocket = new WebSocket("ws://" + window.location.host + "/jakarta.faces.push/fahrzeug-control");
      fahrzeugControlSocket.onmessage = function (event) {
        updateFahrzeug();
      }
    </h:outputScript>

  </ui:define>
</ui:composition>
</html>
