<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/templates/v5t11.xhtml">
  <ui:param name="title" value="System Control"/>

  <ui:define name="content">
    <h:form prependId="false" id="content">
      <p:growl id="msgs" showDetail="true"/>

      <p:fieldset legend="Allgemein">
        <h:panelGrid columns="2">
          <p:outputLabel for="gleisspannung" value="Gleisspannung: "/>
          <p:selectBooleanButton id="gleisspannung" value="#{systemControlPresenter.gleisspannung}" onLabel="an"
                                 offLabel="aus" style="width:60px">
            <p:ajax/>
          </p:selectBooleanButton>
        </h:panelGrid>
      </p:fieldset>

      <p:fieldset id="fahrweg" legend="Fahrweg">
        <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
          <p:outputLabel for="bereich" value="Bereich:"/>
          <p:selectOneMenu id="bereich" value="#{systemControlPresenter.bereich}" style="width:125px">
            <f:selectItems value="#{systemControlPresenter.bereiche}"/>
            <p:ajax event="itemSelect" update="gleis weiche signal"/>
          </p:selectOneMenu>

          <p:outputLabel for="gleis" value="Gleis:"/>
          <h:panelGroup id="gleis">
            <p:selectOneMenu value="#{systemControlPresenter.gleisName}" style="width:125px">
              <f:selectItems value="#{systemControlPresenter.gleise}" var="gleis" itemLabel="#{gleis.name}"
                             itemValue="#{gleis.name}"/>
              <p:ajax event="itemSelect" update="gleis"/>
            </p:selectOneMenu>
            <p:selectBooleanButton id="gleisBesetzt" value="#{systemControlPresenter.gleisBesetzt}" onLabel="besetzt"
                                   offLabel="frei" disabled="#{systemControlPresenter.zentraleVerbunden}"
                                   style="width:120px">
              <p:ajax/>
            </p:selectBooleanButton>
          </h:panelGroup>

          <p:outputLabel for="weiche" value="Weiche:"/>
          <h:panelGroup id="weiche">
            <p:selectOneMenu value="#{systemControlPresenter.weichenName}" style="width:125px">
              <f:selectItems value="#{systemControlPresenter.weichen}" var="weiche" itemLabel="#{weiche.name}"
                             itemValue="#{weiche.name}"/>
              <p:ajax event="itemSelect" update="weiche"/>
            </p:selectOneMenu>
            <p:selectOneButton value="#{systemControlPresenter.weichenStellung}">
              <f:selectItems value="#{systemControlPresenter.weichenStellungen}"/>
              <p:ajax/>
            </p:selectOneButton>
          </h:panelGroup>

          <p:outputLabel for="signal" value="Signal:"/>
          <h:panelGroup id="signal">
            <p:selectOneMenu value="#{systemControlPresenter.signalName}" style="width:125px">
              <f:selectItems value="#{systemControlPresenter.signale}" var="signal" itemLabel="#{signal.name}"
                             itemValue="#{signal.name}"/>
              <p:ajax event="itemSelect" update="signal"/>
            </p:selectOneMenu>
            <p:selectOneButton value="#{systemControlPresenter.signalStellung}">
              <f:selectItems value="#{systemControlPresenter.signalStellungen}"/>
              <p:ajax/>
            </p:selectOneButton>
          </h:panelGroup>

        </h:panelGrid>
      </p:fieldset>

      <p:fieldset id="lok" legend="Lok">
        <p:remoteCommand name="updateLok" process="@none" update="lok msgs"/>
        <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
          <p:outputLabel for="lokIdAktiv" value="Lok:"/>
          <h:panelGroup id="lokIdAktiv">
            <p:selectOneMenu id="lokId" value="#{systemControlPresenter.lokId}" editable="true" style="width:125px">
              <f:selectItems value="#{systemControlPresenter.loks}" var="lok"
                             itemLabel="#{lok.id.adresse}@#{lok.id.systemTyp}" itemValue="#{lok.id}"/>
              <p:ajax event="valueChange" oncomplete="updateLok();"/>
              <p:ajax event="itemSelect" oncomplete="updateLok();"/>
            </p:selectOneMenu>
            <p:selectBooleanButton id="lokAktiv" value="#{systemControlPresenter.lokAktiv}" onLabel="aktiv"
                                   offLabel="inaktiv" style="width:120px">
              <p:ajax/>
            </p:selectBooleanButton>
          </h:panelGroup>

          <p:outputLabel for="lokFahrstufe" value="Fahrstufe:"/>
          <h:panelGrid id="lokFahrstufe" columns="2">
            <p:inputText id="fahrstufe" value="#{systemControlPresenter.lokFahrstufe}"/>
            <p:selectBooleanButton id="lokRueckwaerts" value="#{systemControlPresenter.lokRueckwaerts}"
                                   onLabel="rückwärts" offLabel="vorwärts" style="width:120px">
              <p:ajax/>
            </p:selectBooleanButton>
            <p:slider for="fahrstufe" minValue="0" maxValue="#{systemControlPresenter.lokMaxFahrstufe}">
              <p:ajax process="fahrstufe"/>
            </p:slider>
          </h:panelGrid>

          <p:outputLabel for="lokFunktionen" value="Funktionen:"/>
          <h:panelGroup id="lokFunktionen">
            <p:selectBooleanButton id="lokLicht" value="#{systemControlPresenter.lokLicht}" onLabel="Licht"
                                   offLabel="Licht" style="width:120px">
              <p:ajax/>
            </p:selectBooleanButton>

            <c:forEach var="fn" items="#{systemControlPresenter.lokFunktionen}">
              <p:selectBooleanButton value="#{fn.on}" onLabel="#{fn.nr+1}" offLabel="#{fn.nr+1}" style="width:50px">
                <p:ajax/>
              </p:selectBooleanButton>
            </c:forEach>
          </h:panelGroup>
        </h:panelGrid>
      </p:fieldset>

    </h:form>

    <!--    <f:websocket channel="uiRefresh">-->
    <!--      <f:ajax event="fahrzeug" render=":content" />-->
    <!--      <f:ajax event="signal" render=":content" />-->
    <!--      <f:ajax event="weiche" render=":content" />-->
    <!--      <f:ajax event="zentrale" render=":content" />-->
    <!--    </f:websocket>-->

    <p:remoteCommand name="updateContent" update=":content"/>
    <f:websocket channel="system-control" onmessage="updateContent"/>
  </ui:define>
</ui:composition>
</html>
